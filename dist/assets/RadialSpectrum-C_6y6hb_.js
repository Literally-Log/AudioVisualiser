import{r as u,a as A,j as d}from"./r3f-CAPphJur.js";import{u as F}from"./index-C_JvfRo6.js";import{e as R,a2 as H,a5 as V,a3 as B,a4 as I}from"./three-DPks-rhs.js";import"./postprocessing-CdYowpSz.js";function K(){const{frameDataRef:P,settings:a}=F(),k=u.useRef(null),h=u.useRef(null),l=a.visualization.resolution,y=a.visualization.scale,m=a.peakHold,g=a.frequencyTuning,w=u.useRef([]),G=u.useMemo(()=>new R,[]),j=u.useMemo(()=>new R,[]),z=u.useMemo(()=>new R,[]),{bars:b,peakDots:D}=u.useMemo(()=>{const s=Math.max(.02,Math.PI*2*1.5/l*.7),n=new H(s,1,s),p=[],i=[],v=new V(s*.8,6,6);for(let t=0;t<l;t++){const f=t/l*Math.PI*2,e=new B({color:"#ffffff",transparent:!0,opacity:.9});p.push({geom:n,mat:e,angle:f});const o=new B({color:"#ffffff",transparent:!0,opacity:.9});i.push({geom:v,mat:o,angle:f})}return w.current=Array.from({length:l},()=>({value:0,time:0})),{bars:p,peakDots:i}},[l,y]);return A(s=>{const n=s.clock.elapsedTime,p=P.current.frequencyData,i=k.current;if(!p||!i)return;i.rotation.z=n*(a.effects.rotationSpeed*.2||.1);const v=Math.floor(p.length/l),t=w.current;G.set(a.colors.primary),j.set(a.colors.secondary),i.children.forEach((f,e)=>{const o=f,r=b[e],M=e/l;let c=1;M<.05?c=g.subBassGain/100:M<.15?c=g.bassGain/100:M<.5?c=g.midGain/100:c=g.trebleGain/100;const S=p[e*v]/255*a.sensitivity.overall*c,C=Math.min(1,S),T=.1+(1-g.smoothness/100)*.4,E=1.5*y,x=I.lerp(o.scale.y,C*3*y+.1,T);if(o.scale.y=x,o.position.x=Math.cos(r.angle)*(E+x*.5),o.position.y=Math.sin(r.angle)*(E+x*.5),o.rotation.z=r.angle-Math.PI/2,z.copy(G).lerp(j,C),r.mat.color.copy(z),m.enabled&&t[e]){const q=x;q>t[e].value?(t[e].value=q,t[e].time=n):n-t[e].time>m.falloffTime&&(t[e].value=I.lerp(t[e].value,0,.05))}}),h.current&&(h.current.visible=m.enabled,h.current.rotation.z=i.rotation.z,m.enabled&&h.current.children.forEach((f,e)=>{const o=f,r=b[e];if(t[e]&&r){const c=1.5*y+t[e].value+.2;o.position.x=Math.cos(r.angle)*c,o.position.y=Math.sin(r.angle)*c,o.scale.set(m.scaleX,m.scaleY,1),D[e]?.mat.color.set(a.colors.accent)}}))}),d.jsxs("group",{children:[d.jsx("group",{ref:k,children:b.map((s,n)=>d.jsx("mesh",{geometry:s.geom,material:s.mat},n))}),d.jsx("group",{ref:h,children:D.map((s,n)=>d.jsx("mesh",{geometry:s.geom,material:s.mat},n))})]})}export{K as default};
